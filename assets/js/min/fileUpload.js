var dropZone=document.getElementById("dropZone"),dropZoneText=document.getElementById("dropZoneText"),fileName=document.getElementById("fileName"),replaceText=document.getElementById("replaceText"),fileUpload=document.getElementById("fileUpload"),uploadForm=document.getElementById("uploadForm"),turnstileToken="",turnstileWidgetId=null,isLoggedIn=!1;function checkSession(){fetch("/api/checkSession").then((function(e){return e.json()})).then((function(e){isLoggedIn=e.loggedIn;var t=document.getElementById("account-section"),n=document.getElementById("createAccText"),o=document.getElementById("turnstile-container"),i=document.getElementById("username-display");e.loggedIn?(t&&(t.style.display="block"),i&&(i.textContent="@"+e.username),n&&(n.style.display="none"),o&&(o.style.display="none")):(t&&(t.style.display="none"),n&&(n.style.display="block"),o&&(o.style.display="block"),setTimeout(initTurnstile,100))})).catch((function(e){var t=document.getElementById("account-section"),n=document.getElementById("createAccText");t&&(t.style.display="none"),n&&(n.style.display="block"),setTimeout(initTurnstile,100)}))}function initTurnstile(){var e=document.getElementById("turnstile-container");if(window.turnstile){if(e&&!isLoggedIn)try{turnstileWidgetId=turnstile.render("#turnstile-container",{sitekey:"0x4AAAAAACDFfOKm7uvwfqiR",theme:"dark",callback:window.turnstileCallback})}catch(e){console.error("Turnstile error:",e)}}else setTimeout(initTurnstile,500)}function showLinks(e){var t=document.getElementById("link-container"),n=document.getElementById("file-link-direct"),o=document.getElementById("copy-button-1");t&&(t.style.display="flex"),n&&(n.textContent=e),o&&(o.onclick=function(){copyText(e)})}function resetForm(){dropZoneText.style.display="block",fileName.style.display="none",fileName.textContent="",dropZone.classList.remove("filed"),replaceText.style.display="none",fileUpload.value="",window.turnstile&&!isLoggedIn&&null!==turnstileWidgetId&&(turnstile.reset(turnstileWidgetId),turnstileToken="")}function copyText(e){navigator.clipboard.writeText(e).then((function(){notify("Copied to clipboard!","success")})).catch((function(){notify("Failed to copy","error")}))}window.turnstileCallback=function(e){turnstileToken=e},dropZone.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),dropZone.classList.add("hover")})),dropZone.addEventListener("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),dropZone.classList.remove("hover")})),dropZone.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files;t.length>0&&(fileUpload.files=t,fileUpload.dispatchEvent(new Event("change")))})),dropZone.addEventListener("click",(function(){fileUpload.click()})),fileUpload.addEventListener("change",(function(e){var t=e.target.files[0];t&&(dropZoneText.style.display="none",fileName.textContent=t.name,fileName.style.display="block",dropZone.classList.add("filed"),dropZone.classList.remove("hover"),replaceText.style.cssText="display:inline-block; text-align:center; width:100%;")})),uploadForm.addEventListener("submit",(function(e){if(e.preventDefault(),fileUpload.files&&0!==fileUpload.files.length)if(isLoggedIn||turnstileToken){var t=new FormData;t.append("file",fileUpload.files[0]),turnstileToken&&t.append("token",turnstileToken);var n=uploadForm.querySelector('button[type="submit"]'),o=n.textContent;n.disabled=!0,n.textContent="Uploading...",fetch("/api/uploadFile",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){"success"===e.status?(notify(e.message,"success"),showLinks(window.location.origin+e.path),resetForm()):notify(e.message||"Upload failed","error")})).catch((function(e){notify("An error occurred during upload","error")})).finally((function(){n.disabled=!1,n.textContent=o}))}else notify("Please complete the captcha!","error");else notify("Please select a file!","error")})),document.addEventListener("DOMContentLoaded",checkSession);